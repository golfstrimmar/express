function gwcpIsCustomQtyFieldMatch(t,i,e){if(!isNaN(parseInt(e.fieldId)))return t;var n=/(quantity)_([0-9]+)/.exec(e.fieldId);if(!n||"quantity"!=n[1])return t;var r=gformGetProductQuantity(i,n[2]);return gf_matches_operation(r+"",e.value,e.operator)}!function(m){window.GWConditionalPricing=function(l,t,i){var a=this;return a._formId=l,a._pricingLogic=t,a._basePrices=i,a._triggerTimer={},this.pricingIteration=0,this.init=function(){var i,e=this,t=GWConditionalPricing.getFormElement(this._formId),n=["select","input:not( .ginput_total + input )","textarea"].join(", "),r=['input[type="checkbox"]','input[type="radio"]','input[type="number"]'].join(", "),o=['input[type="text"]','input[type="hidden"]','input[type="number"]',"textarea"].join(", ");t.on("click",r,function(t){var i=gform.applyFilters("gpcp_update_pricing_delay",100,e,m(this));a.debouncedUpdatePricing(e.getFieldIdFromHtmlId(m(this).attr("id")),i)}).on("change",n,function(t){a.debouncedUpdatePricing(e.getFieldIdFromHtmlId(m(this).attr("id")),100)}).on("keyup",o,function(t){clearTimeout(i),i=setTimeout(function(){a.updatePricing(e.getFieldIdFromHtmlId(m(this).attr("id")))},300)}),gform.addFilter("gform_is_value_match","gwcpIsCustomQtyFieldMatch"),t.data("gwcp",e),e.updatePricing()},GWConditionalPricing.getFormElement=function(t){var i=m(gform.applyFilters("gpcp_form_element","#gform_wrapper_"+t));return i.length<=0&&(i=m("#gform_"+t)),i},a.debouncedUpdatePricing=function(t,i){clearTimeout(a._triggerTimer[t]),a._triggerTimer[t]=setTimeout(function(){a.updatePricing(t)},i)},this.updatePricing=function(t){this.ruleCache[l]={},this.pricingIteration++;var i=!t;for(var e in this._pricingLogic)if(this._pricingLogic.hasOwnProperty(e)){var n=this._pricingLogic[e];if(n&&null!==n[0]){var r=parseInt(e)==t,o=this.isDependency(t,n);if(i||r||o){for(var a=!1,c=0;c<n.length;c++){var u=n[c];if(this.isMatch(this._formId,u.conditionalLogic)){a=!0,GWConditionalPricing.setPrice(e,u.price,this._formId);break}}a||GWConditionalPricing.setPrice(e,!1,this._formId)}}}gform.doAction("gpcp_after_update_pricing",t,this),gformCalculateTotalPrice(this._formId)},this.ruleCache={},this.isMatch=function(t,i){if(!i)return!0;t in this.ruleCache||(this.ruleCache[t]={});for(var e=0,n=0;n<i.rules.length;n++){var r=i.rules[n],o=JSON.stringify(r);o in this.ruleCache[t]||(this.ruleCache[t][o]=gf_is_match(t,r)),this.ruleCache[t][o]&&e++}return"show"==("all"==i.logicType&&e==i.rules.length||"any"==i.logicType&&0<e?i.actionType:"show"==i.actionType?"hide":"show")},GWConditionalPricing.setPrice=function(c,u,l){var g=GWConditionalPricing.getFormElement(l).data("gwcp"),d=new Currency(gf_global.gf_currency_config),s=parseInt(c),t=GWConditionalPricing.getProductInput(c,l),p=1<t.length,f=!1===u,h=u;if(!t)return!1;var _=null;t.each(function(t){var i=m(this),e=i.val(),n="",r=!1,o=p?c+"."+(t+1):c;if(f&&(h=d.toNumber(g.getBasePrice(o))),!1!==(u=gform.applyFilters("gpcp_price",h,{productId:c,isReset:f,input:i,inputId:o,gwcp:g,currency:d,formId:l}))){if(u=d.toNumber(u),i.is("option")||i.is(":radio")){if("|"==i.val())return;n=i.val().split("|")[0]+"|"+u,r=i.is(":selected, :checked"),i.val(n)}else{n=u,r=!0,i.val(d.toMoney(u,!0));var a="_"+g._formId+"_"+s;m("span#input"+a).text(d.toMoney(u,!0))}-1==e.indexOf("|")&&(e=d.toNumber(e)),n!=e&&r&&(null==_?_=i:_.add(i))}}),m(_).change()},GWConditionalPricing.getProductInput=function(t,i){var e=parseInt(t),n="_"+i+"_"+e,r=(t=t.toString(),m("#ginput_base_price"+n));if(r.length<=0){var o=e==t,a=t.split(".")[1]-1;(r=m("#input"+n)).is("ul")?o?r=r.find('input[type="radio"]'):(r=r.find("#choice_"+i+"_"+e+"_"+a)).length<=0&&(r=m("#input"+n+" #choice_"+e+"_"+a)):(r=r.find("option:not( .gf_placeholder )"),o||(r=r.eq(a)))}return!(r.length<=0)&&r},this.getFieldIdFromHtmlId=function(t){if(!t)return!1;var i=t.split("_");return"quantity"==i[1]?i[i.length-1]:"choice"==i[0]||4==i.length?i[i.length-2]:i[i.length-1]},this.getBasePrice=function(t){return this._basePrices[t]},GWConditionalPricing.getProductQuantity=function(t,i){var e,n=m("#ginput_quantity_"+i+"_"+t);return 0<n.length?e=gformIsNumber(n.val())?n.val():0:(quantityElement=m(".gfield_quantity_"+i+"_"+t),e=1,0<quantityElement.find("input").length?e=quantityElement.find("input").val():0<quantityElement.find("select").length&&(e=quantityElement.find("select").val()),gformIsNumber(e)||(e=0)),0<(e=parseFloat(e))&&(_anyProductSelected=!0),e},this.isDependency=function(t,i){for(var e=0;e<i.length;e++)for(var n=0;n<i[e].conditionalLogic.rules.length;n++){var r=i[e].conditionalLogic.rules[n].fieldId;if(parseInt(r)==parseInt(t))return!0;if(-1!=r.indexOf("quantity")&&r.split("_")[1]==t)return!0}return!1},GWConditionalPricing.hasPlaceholder=function(t,i){},this.init()}}(jQuery);
//# sourceMappingURL=gwconditionalpricing.js.map